<html>
<head>
	<title>Colours of Flickr</title>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="main.css">
</head>

<body>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> <!-- jquery.js -->
	<script src="../../scripts/quantize.js"></script> <!-- quantize.js -->
	<script src="../../scripts/color-thief.js"></script> <!-- color-thief.js -->
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script> <!-- d3.js -->
	<script type="text/javascript">

		var interestingnessURL = "https://api.flickr.com/services/rest/?method=flickr.interestingness.getList&api_key=7739714e59de2dbe71e55a9d6f34e286&format=json&nojsoncallback=1&auth_token=72157643230204263-7745643df1dff4ca&api_sig=fdbf75ce89f12833c17241b94c3d8aac";
		// key = db7211ccb284903f1072aef2e78025a6
		// secret = e3f7407b432cd766

		d3.json(interestingnessURL, function(data) {
			console.log(data);
			visualizeData(data.photos.photo); //path to each individual photo
		});

		
		function visualizeData(data){
			//farm{farm-id}.staticflickr.com/{server-id}/{id}_{o-secret}_{size}.(jpg|gif|png)

			var farm;
			var server_id;
			var id;
			var o_secret; 
			var img_URL;
			var imageURLS = new Array();
			// var canvasList = new Array();
			var paletteArray;
			var count = 0;

			//save data to arrays maybe?
			//can't do it outside of d3 because it does not have the data!!
			//save all urls to array!!
			d3.select("body").selectAll("canvas")
			.data(data)
			.enter()
			.append("canvas")
			.attr("class", "image")
			.each(function(d){
				farm = d['farm'];
				server_id = d['server'];
				id = d['id'];
				o_secret = d['secret'];
				img_URL = "http://www.lauriewaxman.com/datadesigncode/realtime/proxy.php?src=https://farm"+ farm +".staticflickr.com/"+ server_id +"/"+ id +"_"+ o_secret +"_s.jpg";
				imageURLS[count] = img_URL;
				count++;
			});
			// .attr("src", function(d){
			// 	farm = d['farm'];
			// 	server_id = d['server'];
			// 	id = d['id'];
			// 	o_secret = d['secret'];
			// 	img_URL = "http://www.lauriewaxman.com/datadesigncode/realtime/proxy.php?src=https://farm"+ farm +".staticflickr.com/"+ server_id +"/"+ id +"_"+ o_secret +"_s.jpg";
			// 	imageURLS[count] = img_URL;
			// 	count++;
			// 	//return ""+img_URL+"";
			// });

			// d3.select("body").selectAll("img")
			// 	.data(data)
			// 	.enter()
			// 	.append("img")
			// 	.attr("class", "image")
			// 	.attr("src", function(d){
			// 		farm = d['farm'];
			// 		server_id = d['server'];
			// 		id = d['id'];
			// 		o_secret = d['secret'];
			// 		img_URL = "https://farm"+ farm +".staticflickr.com/"+ server_id +"/"+ id +"_"+ o_secret +"_s.jpg";
			// 		imageURLS[count] = img_URL;
			// 		count++;
			// 		//return ""+img_URL+"";
			// 	});

			// d3.select("body").selectAll("canvas")
			// 	.data(data)
			// 	.enter()
			// 	.append("canvas")
			// 	.attr("class", "imageCanvas");

			//var imageList = document.getElementsByClassName("image");
			var canvasList = document.getElementsByClassName("image");
			//var img = document.getElementById("preview");

			var i = 0;
			for (i=0; i<100; i++){
				// var thisCanvas = canvasList[10];
				// var thisContext = thisCanvas.getContext("2d");
				// var thisImageURL = imageURLS[i];
				// var img = new Image;
				// img.src = "" + thisImageURL + "";
				// thisContext.drawImage(img,0,0,300,150); //draw the darned thing to the canvas. WHY SO SQUISHED??
				// var thisImageData = thisContext.getImageData(0,0,50,50);


				var thisCanvas = canvasList[i];
				var thisContext = thisCanvas.getContext("2d");
				var img = imageList[i];
				$(window).ready(function(){
					var sourceImage = imageURLS[i];
					var colorThief = new ColorThief();
					var color = colorThief.getColor(sourceImage);
					console.log(color);
					//document.getElementById("mydiv").style.backgroundColor = "rgb(" + color + ")";
				});

				// var myImage = $(imageList[i]);
				// paletteArray = Palette(myImage, 5); 
				//thisContext.drawImage(img,0,0,300,150); //draw the darned thing to the canvas. WHY SO SQUISHED??
				// var thisImageData = newContext.getImageData(0,0,50,50);
				// console.log(thisImageData);
				//dataURIs[i] = thisCanvas.toDataURL();
				//console.log(dataURIs[i]);
				// console.log(dataURIs);
			}
			//console.log(paletteArray);

		}

		// function getPixels(){}

	</script>
</body>
</html>