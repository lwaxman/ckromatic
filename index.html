

<html>
<head>
	<title>Colours of Flickr</title>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="assets/main.css">
	<link href='http://fonts.googleapis.com/css?family=Roboto:400,500,700,300' rel='stylesheet' type='text/css'> <!-- google font -->
</head>

<body>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> <!-- jquery.js -->
	<script src="../../scripts/quantize.js"></script> <!-- quantize.js -->
	<script src="../../scripts/color-thief.js"></script> <!-- color-thief.js -->
	<script src="../../scripts/jquery.lettering-0.6.1.min.js"></script> <!-- lettering.js -->
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script> <!-- d3.js -->

	<div id="titleBox">
		<p id="titleOne">Colours</p><p id="titleTwo">of Flickr</p>
	</div>
	
	<svg id="chart"></svg>
	
	<script type="text/javascript">

	$(document).ready(function() {

		$("#titleOne").lettering();

		var days = new Array();

		days[0] = "https://api.flickr.com/services/rest/?method=flickr.interestingness.getList&api_key=d6a7a478b5c00470404cd2d6fbb015c6&per_page=10&format=json&nojsoncallback=1&auth_token=72157643729774584-59a479c75d83ae9e&api_sig=59306ca1a2b1b3f30c71e593c12370ab"; 
		days[1] = "https://api.flickr.com/services/rest/?method=flickr.interestingness.getList&api_key=d6a7a478b5c00470404cd2d6fbb015c6&date=2014-04-08&per_page=10&format=json&nojsoncallback=1&auth_token=72157643729774584-59a479c75d83ae9e&api_sig=d77c9e7c96c846cb3c6da3e4cc464eb7";
		days[2] = "https://api.flickr.com/services/rest/?method=flickr.interestingness.getList&api_key=d6a7a478b5c00470404cd2d6fbb015c6&date=2014-04-07&per_page=10&format=json&nojsoncallback=1&auth_token=72157643729774584-59a479c75d83ae9e&api_sig=667b89dac28f4249e159b90bfff8809c";
		days[3] = "https://api.flickr.com/services/rest/?method=flickr.interestingness.getList&api_key=d6a7a478b5c00470404cd2d6fbb015c6&date=2014-04-06&per_page=10&format=json&nojsoncallback=1&auth_token=72157643729774584-59a479c75d83ae9e&api_sig=98a437963195b12473986ae1fbae5aa9";
		days[4] = "https://api.flickr.com/services/rest/?method=flickr.interestingness.getList&api_key=d6a7a478b5c00470404cd2d6fbb015c6&date=2014-04-05&per_page=10&format=json&nojsoncallback=1&auth_token=72157643729774584-59a479c75d83ae9e&api_sig=cfcf02f38c9fec62858322de39030f07";
		// days[5] = "";
		// days[6] = "";

		var q=0;
		for(q=0; q<5; q++){
			!function inner(q){
				console.log('load', q)
				d3.json(days[q], function(data) {
					visualizeData(data.photos.photo, q*60); //path to each individual photo
				});	
			}(q);
		}

		//it is using finding all canvases every time, 
		//so it is only getting data from the first canvases, and then failing... ??

		// d3.json(dayBack0, function(data) {
		// 	visualizeData(data.photos.photo, 0); 
		// });
		// d3.json(dayBack1, function(data) {
		// 	visualizeData(data.photos.photo, 60); 
		// });
		// d3.json(dayBack2, function(data) {
		// 	visualizeData(data.photos.photo, 120); 
		// });
		// d3.json(dayBack3, function(data) {
		// 	visualizeData(data.photos.photo, 180); 
		// });
		// d3.json(dayBack4, function(data) {
		// 	visualizeData(data.photos.photo, 240); 
		// });
		// d3.json(dayBack5, function(data) {
		// 	visualizeData(data.photos.photo, 300); 
		// });

		
		function visualizeData(data, startPos, canvasName){

			//converts degrees to radians
			//from http://nickthecoder.wordpress.com/2012/04/15/radian-and-degree-conversion-in-javascript/
			Math.radians = function(degrees){
				return degrees * (Math.PI/180);
			}

			//variables to hold all necessary data from json
			var farm;
			var server_id;
			var id;
			var o_secret; 
			var img_URL;
			var imageURLS = new Array();
			var count = 0;

			//create as many divs as data, 
			//and save all urls to array
			d3.select("body").selectAll("div")//canvas
				.data(data)
				.enter()
				.append("div")//canvas
				.attr("width", "100")
				.attr("height", "100")
				.attr("class", "image")
				.each(function(d){
					farm = d['farm'];
					server_id = d['server'];
					id = d['id'];
					o_secret = d['secret'];
					img_URL = "http://www.lauriewaxman.com/datadesigncode/realtime/proxy.php?src=https://farm"+ farm +".staticflickr.com/"+ server_id +"/"+ id +"_"+ o_secret +"_s.jpg";
					imageURLS[count] = img_URL;
					count++;
				});

			//save all images to array
			var imageList = document.getElementsByClassName("image");

			//runs through images, 
			var imageCount = 0;
			for (imageCount=0; imageCount<imageList.length; imageCount++){
			
				//READ THIS!!! http://tobyho.com/2011/11/02/callbacks-in-loops/
				!function inner(imageCount){
					
					var thisImageURL = imageURLS[imageCount];//get current image url
					
					var img = new Image; //creates new image

					//runs image through Color Thief
					img.onload = function(){

						var colourThief = new ColorThief();
						var palette = colourThief.getPalette(img,5);
						var colour;
						var lastXPos = 0;
						var lastYPos = 0;
					
						//variables for drawing the annuli
						var segHeight = 50;
						var innerRad = 150;
						var outerRad = innerRad+segHeight;
						var startAng;
						var endAng;
						var sliceAngle = 36/imageList.length;
					
						// count = imageList.length;
						
						//run through canvases to get
						for(var j=0; j<imageList.length; j++){

							//get j-th colour from palette
							colour = palette[j]; 
							lastXPos += 20;
							

							console.log(colour);

							//convert angles to radians for use in d3.svg.arc()
							startAng = Math.radians( startPos + (imageCount*sliceAngle));
							endAng = Math.radians( ((startPos-0.5)+sliceAngle) + (imageCount*sliceAngle) ); //-0.5 to have 0.5Ëš gap between them.

							//create arc svg
							var arc = d3.svg.arc()
								.innerRadius(innerRad)
								.outerRadius(outerRad)
								.startAngle(startAng)
								.endAngle(endAng);	

							d3.select('#chart').append("path")
								.attr("d", arc) //add arc svg to chart
								.attr("fill", function(d){
							        return "rgb("+colour[0]+","+colour[1]+","+colour[2]+")";
							    })
							    .attr("stroke-width", "5")
								.attr("transform", "translate(600,400)");

							//inrease radii
							innerRad+=segHeight;
							outerRad+=segHeight;

						}//end Color Thief loop

					};//end image.onload

					//source url of the image, accessed from onload
					img.src = "" + thisImageURL + "";

				}(imageCount); //end inner loop

			}//end run through canvases

		}//end visualizeData()

		function drawArcs(){

			
		}

	});//end document.ready
	</script>
</body>
</html>